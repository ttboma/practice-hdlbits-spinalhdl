# Table of Content

- [Table of Content](#table-of-content)
- [Introduction to Scala and SpinalHDL: A Demonstration Project](#introduction-to-scala-and-spinalhdl-a-demonstration-project)
  - [Scala/SpinalHDL Environment Installation and Setup](#scalaspinalhdl-environment-installation-and-setup)
  - [Project Structure](#project-structure)
  - [Why Scala 2](#why-scala-2)
  - [Why ScalaTest](#why-scalatest)
- [Practice with HDLBits](#practice-with-hdlbits)
- [Practice with HDLBits](#practice-with-hdlbits-1)
- [Developer's Note](#developers-note)
  - [How to start with Vscode and metal](#how-to-start-with-vscode-and-metal)
  - [Pre-commit Hooks](#pre-commit-hooks)
  - [Trouble Shooting](#trouble-shooting)
    - [Installing OSS CAD Suite on Mac](#installing-oss-cad-suite-on-mac)
    - [Using X11 Forwarding on Mac](#using-x11-forwarding-on-mac)

# Introduction to Scala and SpinalHDL: A Demonstration Project

This is a [Scala](https://scala-lang.org/)/[SpinalHDL](https://spinalhdl.github.io/SpinalDoc-RTD/master/index.html) demo project.

Using Scala with SpinalHDL offers a powerful environment for hardware design. By leveraging the expressiveness of Scala, which combines object-oriented programming (OOP) and functional programming paradigms, designers can write high-level, maintainable hardware descriptions. SpinalHDL, as a Scala library, provides advanced features and abstractions that enhance the design process, leading to more efficient workflows and higher quality hardware systems.

For the fastest way to learn Scala and SpinalHDL, refer to the following documentation:

- [Scala Documentation](https://docs.scala-lang.org/scala3/book/introduction.html)
- [SpinalHDL Documentation](https://spinalhdl.github.io/SpinalDoc-RTD/master/index.html)

And here is a great open-source RISC-V CPU that has been implemented completely in SpinalHDL by Charles Papon (who’s also the creator of SpinalHDL.):

- [VexRiscv](https://github.com/SpinalHDL/VexRiscv)

If you have any questions, you can always ask [ChatGPT](https://www.googleadservices.com/pagead/aclk?sa=L&ai=DChcSEwj5hJDMiJSGAxW3H60GHce7A-gYABAAGgJwdg&ase=2&gclid=Cj0KCQjw3ZayBhDRARIsAPWzx8qvhglaeiNR6kJAEBZJ9F-kRDVmvjWMGAKgnNy-EqYfIrvo_BRSAxsaAuDgEALw_wcB&ei=WfpGZsXWA4vL1e8P2ISosA0&ohost=www.google.com&cid=CAESVeD2223mRSwrmwW2iyOazw9chgbsorNTgCQvBG76cFk5WkvwMrDWbz7UpDDbDrXMmNmQKxkENuhvdViYYXU5fW2yCSBLVcnv-YKifA58ieVXZjCk88I&sig=AOD64_1fSvmQ9XW4eZimIsHBHXt4vZb57g&q&sqi=2&nis=4&adurl&ved=2ahUKEwiF54XMiJSGAxWLZfUHHVgCCtYQ0Qx6BAgREAE).

The documentation is organized using [mdBook](https://rust-lang.github.io/mdBook/index.html) and can be read on **Gitea**. After cloning this repository, you can also install mdBook (`cargo install mdbook`) and view the documentation locally by running `mdbook serve --open` in the root directory. Alternatively, if you're using VS Code, you can use an extension like [Web Preview](https://marketplace.visualstudio.com/items?itemName=JabedHossain.web-preview).

The presentation for this documentation can be found in the `slides` folder and was created using [Marp](https://marp.app/#get-started) and can be previewed with tools such as the [Marp for VS Code](https://github.com/marp-team/marp-vscode) extension.
And please check my presentation on 2024-5-24: [2024-5-24-introduction-to-spinalhdl](https://andesone.sharepoint.com/sites/Toolchain/_layouts/15/stream.aspx?id=%2Fsites%2FToolchain%2FShared%20Documents%2FGeneral%2FStudy%20Group%2F20240524%5Fintroduction%5Fto%5Fspinalhdl%2Emp4&referrer=StreamWebApp%2EWeb&referrerScenario=AddressBarCopied%2Eview%2E27a8fce6%2Daa6c%2D4405%2D97bc%2D290f0c8702e7)

## Scala/SpinalHDL Environment Installation and Setup

To install and setup Scala/SpinalHDL environment, please follow this page [Install and setup](https://spinalhdl.github.io/SpinalDoc-RTD/master/SpinalHDL/Getting%20Started/Install%20and%20setup.html). In this project, we demonstrate how to:

- Build the project using **Scala 2** and the [sbt](https://www.scala-sbt.org/) build tool. Compile the code with `sbt compile`, run it with `sbt run`, and start a **Scala 2 REPL** with `sbt console`.
- Integrate [ScalaTest](https://www.scalatest.org/). Run tests with `sbt test`.
- Use VSCode for editing, with the [Scala (Metals)](https://scalameta.org/metals/docs/editors/vscode/) extension.
- Utilize external HDL simulators [Verilator](https://www.veripool.org/verilator/) as the backend, and [Gtkwave](https://gtkwave.sourceforge.net/) to view the waves generated by Verilator during simulation.
- Perform formal verification with the open-source [Symbi-Yosys](https://github.com/YosysHQ/oss-cad-suite-build) toolchain.

Please note that [Verilator](https://www.veripool.org/verilator/) and [Gtkwave](https://gtkwave.sourceforge.net/) are included in the [Symbi-Yosys](https://github.com/YosysHQ/oss-cad-suite-build) suite. For instance, I downloaded the [oss-cad-suite-darwin-arm64-20240521.tgz](https://github.com/YosysHQ/oss-cad-suite-build/releases/download/2024-05-21/oss-cad-suite-darwin-arm64-20240521.tgz) and used the following commands:

## Project Structure

This project is based on the Scala template created with the command `sbt new scala/hello_world.g8`, which pulls a project template from GitHub. The following shows the structure of this project:

- All Scala/SpinalHDL code is located in `src/main`, while unit tests are in `src/test`.
- The generated simulation files and Verilog files will be placed in the `gen` and `simWorkspace` folders.
- The `.bloop`, `.metals`, `.scalafmt.conf`, `.vscode`, `project`, `target`, and `tmp` folders are automatically created by VSCode and the [Scala (Metals)](https://scalameta.org/metals/docs/editors/vscode/) extension. These can be ignored.
- The `.git` directory is created by Git. The `.gitignore` file is adapted from the [SpinalHDL template](https://github.com/SpinalHDL/SpinalTemplateSbt.git) with a few minor modifications.
- The `book.toml` file contains [mdbook](https://rust-lang.github.io/mdBook/index.html) settings. The `book` directory is created by mdbook and can be ignored, while all documentation is in the `docs` folder.
- The presentation slides and the video are located in the `docs/slides` folder.

```sh
.
├── .bloop
├── .git
├── .gitignore
├── .metals
├── .scalafmt.conf
├── .vscode
├── book
├── book.toml
├── build.sbt
├── docs
│   └── slides
├── gen
├── project
├── simWorkspace
├── slides
├── src
│   ├── main
│   │   └── scala
│   └── test
│       └── scala
├── target
└── tmp
```

## Why Scala 2

Seems like **SpinalHDL** cannot work with **Scala 3**. Both [VexRiscv](https://github.com/SpinalHDL/VexRiscv) and the SpinalHDL template from `git clone --depth 1 https://github.com/SpinalHDL/SpinalTemplateSbt.git MySpinalProject` compile with **Scala 2**. And if we use "2.11.12", the following error message will shows up, so we choose Scala version "2.12.19" as suggested:

```txt
You are using legacy Scala version 2.11.12, which might no longer be supported by Metals in the future. To get the best support possible it's recommended to update to at least Scala version 2.12.19.
```

## Why ScalaTest

Because it has the most stability guarantee, and an another SpinalHDL project [VexRiscv](https://github.com/SpinalHDL/VexRiscv) is depending on ScalaTest as well.
Another choice originally from the scala template is [MUnit](https://scalameta.org/munit/docs/getting-started.html). But it has no stability guarantees.

Note that it is not realistic to do simulation with ScalaTest. To find out usage of ScalaTest, [VexRiscv](https://github.com/SpinalHDL/VexRiscv) is a good code-base to trace.

# Practice with HDLBits

SpinalHDL has a steep learning curve. To get started, I recommend practicing how to write SpinalHDL code using this website: [HDLBits — Verilog Practice](https://hdlbits.01xz.net/wiki/Main_Page).

I have included several practice solutions in the `src/main/scala/hdlbits` folder. The generated simulation files and Verilog files will be placed in the `gen` and `simWorkspace` folders.

Please note that these solutions are not necessarily optimal, but rather intended to help you gradually work through the SpinalHDL language.

The recommended order for checking out these demos is as follows:

1. `spinal-hdl-demo/src/main/scala/hdlbits/verilog_language/7458.scala`
2. `spinal-hdl-demo/src/main/scala/hdlbits/verilog_language/Vectorgates.scala`
3. `spinal-hdl-demo/src/main/scala/hdlbits/verilog_language/Vector2.scala`
4. `spinal-hdl-demo/src/main/scala/hdlbits/verilog_language/Vector3.scala`
5. `spinal-hdl-demo/src/main/scala/hdlbits/verilog_language/Vector5.scala`
6. `spinal-hdl-demo/src/main/scala/hdlbits/verilog_language/ModuleAddSub.scala`
7. `spinal-hdl-demo/src/main/scala/hdlbits/circuits/Dff8ar.scala`
8. `spinal-hdl-demo/src/main/scala/hdlbits/circuits/Dff8p.scala`
9. `spinal-hdl-demo/src/main/scala/hdlbits/circuits/Countbcd.scala`
10. `spinal-hdl-demo/src/main/scala/spinal_hdl_template_demo/*`
11. `/Users/shiehyuehchang/Desktop/spinal-hdl-demo/src/main/scala/other_demo/VaceCtrl.scala`

# Practice with HDLBits

SpinalHDL has a steep learning curve. To get started, I recommend practicing how to write SpinalHDL code using this website: [HDLBits — Verilog Practice](https://hdlbits.01xz.net/wiki/Main_Page).

I have included several practice solutions in the `src/main/scala/hdlbits` folder. The generated simulation files and Verilog files will be placed in the `gen` and `simWorkspace` folders.

Please note that these solutions are not necessarily optimal, but rather intended to help you gradually work through the SpinalHDL language.

The recommended order for checking out these demos is as follows:

1. `spinal-hdl-demo/src/main/scala/hdlbits/verilog_language/7458.scala`
2. `spinal-hdl-demo/src/main/scala/hdlbits/verilog_language/Vectorgates.scala`
3. `spinal-hdl-demo/src/main/scala/hdlbits/verilog_language/Vector2.scala`
4. `spinal-hdl-demo/src/main/scala/hdlbits/verilog_language/Vector3.scala`
5. `spinal-hdl-demo/src/main/scala/hdlbits/verilog_language/Vector5.scala`
6. `spinal-hdl-demo/src/main/scala/hdlbits/verilog_language/ModuleAddSub.scala`
7. `spinal-hdl-demo/src/main/scala/hdlbits/circuits/Dff8ar.scala`
8. `spinal-hdl-demo/src/main/scala/hdlbits/circuits/Dff8p.scala`
9. `spinal-hdl-demo/src/main/scala/hdlbits/circuits/Countbcd.scala`
10. `spinal-hdl-demo/src/main/scala/spinal_hdl_template_demo/*`
11. `/Users/shiehyuehchang/Desktop/spinal-hdl-demo/src/main/scala/other_demo/VaceCtrl.scala`

# Developer's Note

## How to start with Vscode and metal

```sh
git clone https://github.com/ttboma/spinalhdl-demo
cd spinalhdl-demo
code -a .
```

and then execute metal vscode extension command: `metals.build-import`.
You are good to go.

## Pre-commit Hooks

I choose to apply these [scala-pre-commit-hooks](https://github.com/softwaremill/scala-pre-commit-hooks). Make sure to run `pre-commit install` the first time cloning this project.

## Trouble Shooting

### Installing OSS CAD Suite on Mac

```sh
$ brew install xattr
$ brew install cffi
$ xattr -d com.apple.quarantine oss-cad-suite-darwin-arm64-20240516.tgz
$ tar -xzvf oss-cad-suite-darwin-arm64-20240516.tgz
$ export PATH="<extracted_location>/oss-cad-suite/bin:$PATH"
```

### Using X11 Forwarding on Mac

For instructions on using X11 forwarding on Mac, check out: [X11 Forwarding on Mac](https://www.cyberciti.biz/faq/apple-osx-mountain-lion-mavericks-install-xquartz-server/).
